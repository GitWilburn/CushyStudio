@top File { expression+ }

expression[@isGroup=Expression] {
  WeightedExpression |
  Permutations |

  Lora |
  Wildcard |
  Embedding |
  Tag |

  Separator |
  Break |

  Comment |
  Identifier |
  Number |
  String
}

@skip { space }


WeightedExpression { "(" expression+ ")*" Number }
// LightnendExpression { "[" expression+ (":" Number+)? "]" }

Permutations { "{" expression+ "}" }

Tag { "%" TagName }
TagName {  Identifier | String }

// LORA
// Lora { @specialize<Identifier, "lora"> ":" LoraName  }
Lora { "@" LoraName ( "[" Number ("," Number)? "]" )?   }
LoraName { Identifier | String  }

// WILDCARD
Wildcard { "?" WildcardName }
WildcardName { Identifier | String  }

// EMBEDDING
Embedding { ":" EmbeddingName }
EmbeddingName { Identifier | String  }


@tokens {
  space { @whitespace+ }
  Break { "break" }
  Identifier { ($[A-Za-z0-9._\\\/\-] )+ }
  Number { "-" ?$[0-9.]+ }
  String { '"' !["]* '"' }
  Separator { "," }
  Comment { ";" ![\n]* }
  // WeightedExpression {"{}"}
  @precedence { Comment, Number, Break, Identifier }
}